<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Future Smart Logistics</title>
  <!-- Favicons & Manifest -->
  <link rel="icon"         href="icon-32.png"    sizes="32x32"   type="image/png">
  <link rel="icon"         href="icon-192.png"   sizes="192x192" type="image/png">
  <link rel="shortcut icon" href="icon-32.png"    type="image/png">
  <link rel="manifest"     href="manifest.json">
  <meta name="theme-color" content="#003366">

  <style>
    /* 75% overall zoom */
    html { zoom: 75%; }
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f9fc; color: #333;
    }
    /* Header */
    header {
      height: 60px; line-height: 60px;
      background: #003366; color: #fff;
      text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex: 0 0 60px;
    }
    header h1 { display: inline; margin: 0; font-size: 1.2rem; vertical-align: middle; }
    header p {
      display: inline-block; margin: 0 0 0 1rem;
      font-size: 0.9rem; font-style: italic;
      border-bottom: 1px solid #fff; padding-bottom: 2px; opacity: 0.9;
    }
    /* Main flex container */
    .main {
      display: flex; height: calc(100% - 60px);
    }
    /* Sheet area */
    .sheet {
      flex: 3; height: 100%;
    }
    .sheet iframe {
      width: 100%; height: 100%; border: none; border-radius: 6px;
    }
    /* Panel area */
    .panel {
      flex: 1; height: 100%;
      background: #fff; border-left: 1px solid #ddd;
      padding: 1rem; box-shadow: -2px 0 6px rgba(0,0,0,0.05);
      display: flex; flex-direction: column; justify-content: space-between;
    }
    .panel h2 {
      margin: 0 0 1rem; font-size: 1rem; color: #003366; text-align: center;
    }
    .panel label {
      display: block; margin-top: 0.8rem; font-weight: 600; font-size: 0.9rem;
    }
    .panel input, .panel select, .panel textarea {
      width: 100%; padding: 0.4rem; margin-top: 0.3rem;
      font-size: 0.9rem; border: 1px solid #ccc; border-radius: 4px;
    }
    .panel textarea { height: 100px; resize: vertical; }
    .dispatch-form {
      margin-top: 1rem; padding: 0.5rem; border:1px solid #ccc; border-radius:4px;
      max-height: 200px; overflow-y: auto;
    }
    .panel button {
      width: 100%; padding: 0.6rem; margin-top: 0.5rem;
      background: #007bff; color: #fff; border: none; border-radius: 4px;
      font-size: 0.9rem; cursor: pointer;
    }
    .panel button:hover { background: #0056b3; }
    .next-serial {
      text-align: center; margin-top: 1rem; font-weight: bold; font-size: 0.9rem;
    }
    #installBtn {
      background: #28a745; display: none;
    }
    .signature {
      text-align: center; font-size: 0.75rem; color: #888; margin-top: 1rem;
    }
  </style>
</head>
<body>

  <header>
    <h1>üìû Sales Dialer - Future Smart Logistics</h1>
    <p>Track calls, log notes & reach leads effectively</p>
  </header>

  <div class="main">
    <!-- Google Sheet -->
    <div class="sheet">
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQHAylQdwmgOaWzvATwSkV9Ax79cjjGWMkhJNf31JCggH8Zp79-I6TEgafLW514osMIeKKzo9CWl_ES/pubhtml?widget=true&amp;headers=false"></iframe>
    </div>

    <!-- Control Panel -->
    <div class="panel">
      <div style="overflow:auto; flex:1;">
        <h2>Call Tracker</h2>

        <label for="serialInput">Last Dialed Serial:</label>
        <input type="number" id="serialInput" value="0"/>
        <button onclick="incrementSerial(5)">‚ûï Increment by 5</button>
        <div class="next-serial">
          üìå Next Serial: <span id="nextSerial">1‚ÄØ‚Äì‚ÄØ5</span>
        </div>

        <label for="callNotes">üìù Notes:</label>
        <textarea id="callNotes" placeholder="Write call details here..."></textarea>
        <button onclick="saveNotes()">üíæ Save Notes</button>

        <!-- Dispatch Lead Form -->
        <div class="dispatch-form">
          <h3 style="margin:0 0.5rem;font-size:0.95rem;color:#003366;">üöö Dispatch Lead Form</h3>

          <label for="mc">MC#:</label>
          <input type="text" id="mc" placeholder="MC-1600017"/>

          <label>Equipment (1 or 2):</label>
          <div style="display:flex; gap:0.5rem; align-items:center;">
            <select id="equip1">
              <option value="">‚Äî Select ‚Äî</option>
              <option>BX</option><option>PO</option><option>DV</option>
              <option>FB</option><option>RF</option><option>Other</option>
            </select>
            <input type="text" id="equip1Other" placeholder="Specify" style="display:none; flex:1;"/>

            <select id="equip2">
              <option value="">‚Äî Optional ‚Äî</option>
              <option>BX</option><option>PO</option><option>DV</option>
              <option>FB</option><option>RF</option><option>Other</option>
            </select>
            <input type="text" id="equip2Other" placeholder="Specify" style="display:none; flex:1;"/>
          </div>

          <label>Length (1 or 2):</label>
          <div style="display:flex; gap:0.5rem; align-items:center;">
            <select id="length1">
              <option value="">‚Äî Select ‚Äî</option>
              <option>53</option><option>48</option><option>26</option><option>Other</option>
            </select>
            <input type="number" id="length1Other" placeholder="ft" style="display:none;width:60px;"/>

            <select id="length2">
              <option value="">‚Äî Optional ‚Äî</option>
              <option>53</option><option>48</option><option>26</option><option>Other</option>
            </select>
            <input type="number" id="length2Other" placeholder="ft" style="display:none;width:60px;"/>
          </div>

          <label for="lp">L/P:</label>
          <select id="lp"><option>Loaded</option><option>Empty</option></select>

          <label for="zip">Zip Code:</label>
          <input type="text" id="zip" placeholder="12345"/>

          <label for="haulType">Haul Type:</label>
          <select id="haulType"><option>Short Haul</option><option>Long Haul</option></select>

          <label>RPM Short (min‚Äìmax):</label>
          <div style="display:flex; gap:0.3rem;">
            <input type="number" id="rpmShortMin" placeholder="min"/>
            <input type="number" id="rpmShortMax" placeholder="max"/>
          </div>

          <label>RPM Long (min‚Äìmax):</label>
          <div style="display:flex; gap:0.3rem;">
            <input type="number" id="rpmLongMin" placeholder="min"/>
            <input type="number" id="rpmLongMax" placeholder="max"/>
          </div>

          <label for="pct">Rate (%):</label>
          <input type="number" id="pct" placeholder="1.5"/>

          <label for="dispatcherComment">Comment for Dispatcher:</label>
          <textarea id="dispatcherComment" placeholder="Special instructions..."></textarea>
        </div>

        <button onclick="saveLead()">üíæ Save Lead</button>
      </div>

      <button id="installBtn">üöÄ Install App</button>
      <div class="signature">Developed by Skp Dispatch Solutions</div>
    </div>
  </div>

  <script>
    // Serial logic
    const serialInput = document.getElementById('serialInput'),
          nextSerial   = document.getElementById('nextSerial'),
          callNotes    = document.getElementById('callNotes');
    function updateNextSerial(){
      const c = parseInt(serialInput.value)||0;
      nextSerial.textContent = `${c+1}‚ÄØ‚Äì‚ÄØ${c+5}`;
    }
    function incrementSerial(n){
      serialInput.value = (parseInt(serialInput.value)||0) + n;
      updateNextSerial();
    }
    serialInput.addEventListener('input', updateNextSerial);
    updateNextSerial();

    // Notes save
    function saveNotes(){
      const blob = new Blob([callNotes.value],{type:'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'notes.txt';
      a.click();
    }

    // ‚ÄúOther‚Äù toggles
    [['equip1','equip1Other'],['equip2','equip2Other'],['length1','length1Other'],['length2','length2Other']]
      .forEach(([selId, otherId]) => {
        const sel = document.getElementById(selId),
              other = document.getElementById(otherId);
        sel.addEventListener('change', ()=> {
          if(sel.value==='Other') other.style.display='block';
          else { other.style.display='none'; other.value=''; }
        });
      });

    // Save Lead
    function saveLead(){
      const mc    = document.getElementById('mc').value;
      const phone = document.getElementById('phone').value;
      const e1    = document.getElementById('equip1'),
            e2    = document.getElementById('equip2'),
            eo1   = document.getElementById('equip1Other'),
            eo2   = document.getElementById('equip2Other');
      const valEquip1 = e1.value==='Other'? eo1.value : e1.value,
            valEquip2 = e2.value==='Other'? eo2.value : e2.value;
      const equipList = [valEquip1,valEquip2].filter(v=>v).join(', ');
      const l1    = document.getElementById('length1'),
            l2    = document.getElementById('length2'),
            lo1   = document.getElementById('length1Other'),
            lo2   = document.getElementById('length2Other');
      const valLen1 = l1.value==='Other'? lo1.value : l1.value,
            valLen2 = l2.value==='Other'? lo2.value : l2.value;
      const lengthList = [valLen1,valLen2].filter(v=>v).join(', ');
      const lp    = document.getElementById('lp').value;
      const zip   = document.getElementById('zip').value;
      const haul  = document.getElementById('haulType').value;
      const rpmS  = document.getElementById('rpmShortMin').value + '‚Äì' + document.getElementById('rpmShortMax').value;
      const rpmL  = document.getElementById('rpmLongMin').value  + '‚Äì' + document.getElementById('rpmLongMax').value;
      const pct   = document.getElementById('pct').value + '%';
      const comment = document.getElementById('dispatcherComment').value;

      const fields = [
        ['MC#', mc],
        ['Phone', phone],
        ['Equipment', equipList],
        ['Length', lengthList],
        ['L/P', lp],
        ['Zip', zip],
        ['Haul Type', haul],
        ['RPM Short', rpmS],
        ['RPM Long', rpmL],
        ['Rate %', pct],
        ['Dispatcher Note', comment]
      ];
      let txt = '--- Dispatch Lead ---\n';
      fields.forEach(f=> txt += `${f[0]}: ${f[1]}\n`);
      const blob = new Blob([txt],{type:'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'lead.txt';
      a.click();
    }

    // PWA Install flow
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', e=>{
      e.preventDefault(); deferredPrompt=e;
      document.getElementById('installBtn').style.display='block';
      document.getElementById('installBtn').onclick=()=>{
        deferredPrompt.prompt();
        deferredPrompt.userChoice.finally(()=>deferredPrompt=null);
      };
    });

    // Register SW
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js').catch(console.error);
    }
  </script>
</body>
</html>
